{% extends "base.html" %}
{% block content %}
<a id="results"></a>
<section class="relative">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Summary Bar -->
    <div class="summary-bar">
      <div class="summary-chip">
        <span class="chip-label">Target</span>
        <span class="chip-value">{{ plan.calories }} kcal / day</span>
      </div>
      <div class="summary-chip">
        <span class="chip-label">Protein</span>
        <span class="chip-value">{{ plan.protein_target }} g/day</span>
      </div>
      {% if plan.bmr %}
      <div class="summary-chip">
        <span class="chip-label">BMR</span>
        <span class="chip-value">{{ plan.bmr }}</span>
      </div>
      {% endif %}
      {% if plan.tdee %}
      <div class="summary-chip">
        <span class="chip-label">TDEE</span>
        <span class="chip-value">{{ plan.tdee }}</span>
      </div>
      {% endif %}
      <div class="summary-chip">
        <span class="chip-label">Diet</span>
        <span class="chip-value">{{ 'Low‑carb' if plan.low_carb else '40/30/30' }}</span>
      </div>
      <div class="summary-chip">
        <span class="chip-label">Weekly Cost</span>
        <span class="chip-value">${{ '%.2f'|format(plan.total_cost or 0) }}</span>
      </div>
    </div>

    <!-- Plan Grid -->
    <div class="grid md:grid-cols-2 gap-5 mt-6">
      {% for day in plan.days %}
      <div class="day-card">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">Day {{ loop.index }}</h2>
          <div class="pill">
            <span>{{ day.total_protein }} g</span>
            <span class="sep">•</span>
            <span>{{ day.total_calories|int }} kcal</span>
          </div>
        </div>
        <div class="space-y-2">
          {% for m in day.meals %}
          <div class="meal">
            <div class="text-sm font-medium">{{ m.title }}</div>
            <div class="macro-line">
              <span>P {{ m.macros.P }}</span>
              <span>C {{ m.macros.C }}</span>
              <span>F {{ m.macros.F }}</span>
              <span>K {{ m.macros.K }}</span>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Grocery -->
    <div class="mt-10">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold">Smart Grocery List</h3>
        <div class="flex gap-2">
          <a href="/export/plan.pdf" class="btn-soft">Download Plan PDF</a>
          <a href="/export/grocery.pdf" class="btn-soft">Download Grocery PDF</a>
        </div>
      </div>

      {% if plan.grocery %}
        {% for aisle, items in plan.grocery.items() %}
          <div class="aisle">
            <div class="aisle-title">{{ aisle }}</div>
            <div class="grid sm:grid-cols-2 gap-2">
            {% for it in items %}
              <div class="g-item">
                <div class="truncate pr-3">
                  <div class="text-sm font-medium truncate">{{ it.name }}</div>
                  <div class="text-xs text-slate-400">{{ it.package }}</div>
                </div>
                <a class="insta" target="_blank" href="{{ it.instacart_url }}">Open</a>
              </div>
            {% endfor %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-slate-400">No grocery items generated.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
